<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MM Bot – Live Log</title>
    <style>
        body { background: #0d0f17; color: #00ff99; font-family: monospace; }
        .box { background: #11131e; padding: 20px; margin-top: 20px; border-radius: 6px; }
        button { padding: 8px 12px; }
        pre { white-space: pre-wrap; font-size: 14px; margin: 0; }
    </style>
</head>
<body>

<h1>MM Bot – Live Log</h1>

<button onclick="loadLog()">Refresh Log</button>
<div class="box">
    <pre id="log">Loading...</pre>
</div>

<h1>Full Market Scan</h1>
<button onclick="loadScan()">Refresh Scan</button>
<div class="box">
    <pre id="scan">Loading...</pre>
</div>

<script>
// ===== USTAWIENIA =====
const MAX_LINES = 1000;
const AUTO_REFRESH_MS = 5000;

// ===== LOGI =====
function loadLog() {
    fetch('/mm_log')
        .then(r => r.text())
        .then(t => {
            let lines = t.split("\n").filter(x => x.trim().length > 0);

            // Przycinanie logu
            if (lines.length > MAX_LINES) {
                lines = lines.slice(-MAX_LINES);
            }

            // Najnowsze na górze
            lines.reverse();

            const logBox = document.getElementById('log');
            logBox.textContent = lines.join("\n");

            // Zawsze scroll na górę
            logBox.parentElement.scrollTop = 0;
        })
        .catch(_ => {
            document.getElementById('log').textContent = "Error loading log.";
        });
}

// ===== MARKET SCAN =====
function loadScan() {
    fetch('/api/mm/market')
        .then(r => r.json())
        .then(t => {
            let out = "";
            t.pairs.forEach(p => {
                out += `${p.item_name} | APR: ${p.lp_apr} | NET: ${p.net_effective_pct} | vol24 ${p.vol24} | reserve ${p.reserve_vee}\n`;
            });
            document.getElementById('scan').textContent = out;
        })
        .catch(_ => {
            document.getElementById('scan').textContent = "Error loading scan.";
        });
}

// ===== AUTOMATIC REFRESH =====
setInterval(loadLog, AUTO_REFRESH_MS);

// Initial load
loadLog();
loadScan();
</script>

</body>
</html>
